# Техническое задание: Embedding Explorer

## Цель проекта

Создать образовательный веб-инструмент для демонстрации работы эмбеддингов и косинусного сходства в контексте RAG-систем. Проект предназначен для учебных целей — наглядно показать студентам, как текст преобразуется в векторы и как измеряется семантическая близость между фразами.

---

## Функциональные требования

### 1. Ввод фраз

- Поле ввода текста в верхней части страницы
- Кнопка "Добавить" для отправки фразы
- При добавлении:
  - Фраза отправляется на embedding API
  - Полученный вектор сохраняется в состоянии приложения
  - Фразе присваивается буквенный идентификатор (A, B, C, D...)
  - Фраза добавляется в список ниже
- Индикатор загрузки во время вычисления эмбеддинга

### 2. Список фраз с буквенной маркировкой

- Отображение всех добавленных фраз в виде списка/таблицы
- **Буквенная маркировка**: каждая фраза получает уникальную латинскую букву
  - Первая фраза → **A**
  - Вторая фраза → **B**
  - Третья фраза → **C**
  - И так далее до **Z** (максимум 26 фраз)
- Каждая строка содержит:
  - Чекбокс для выбора
  - **Буквенный идентификатор** (A, B, C...) — крупно, в красном круге/badge
  - Текст фразы
  - Кнопка удаления (опционально)
- Максимум **две** фразы могут быть выбраны одновременно для детального сравнения
- При выборе третьей — автоматически снимается выбор с первой выбранной

### 3. Вычисление косинусного сходства (детальное сравнение)

- Когда выбраны ровно две фразы — автоматически вычисляется косинусное сходство
- Результат отображается в специальном блоке:
  - Буквы выбранных фраз: **"A ↔ B"**
  - Значение от -1 до 1 (или 0 до 1 в зависимости от модели)
  - Визуальная шкала/прогресс-бар
  - Интерпретация: "Высокое сходство", "Среднее", "Низкое", "Противоположные значения"
- Формула косинусного сходства для справки студентов:
  ```
  cos(A, B) = (A · B) / (||A|| × ||B||)
  ```

### 4. Выбор провайдера эмбеддингов

Селектор в настройках/header для выбора источника эмбеддингов:

**Вариант A: Ollama (локальный)**
- Модель: `bge-m3`
- Endpoint: `http://localhost:11434/api/embeddings`
- Не требует API ключа

**Вариант B: OpenAI**
- Модели на выбор:
  - `text-embedding-ada-002`
  - `text-embedding-3-small`
  - `text-embedding-3-large`
- Требует API ключ (вводится в настройках или из `.env`)
- Endpoint: `https://api.openai.com/v1/embeddings`

### 5. Настройки

Модальное окно или боковая панель с настройками:
- Выбор провайдера (Ollama / OpenAI)
- Выбор модели (dropdown, зависит от провайдера)
- Поле для OpenAI API Key (с маскировкой)
- Кнопка "Проверить подключение"

---

## Визуализации

### 6. Матрица сходства (Similarity Matrix) — **основная визуализация**

Интерактивная тепловая карта, показывающая косинусное сходство между всеми парами фраз.

#### Внешний вид

```
              A      B      C      D      E
           ┌──────┬──────┬──────┬──────┬──────┐
     A     │ 1.00 │ 0.87 │ 0.45 │ 0.12 │ 0.08 │
           ├──────┼──────┼──────┼──────┼──────┤
     B     │ 0.87 │ 1.00 │ 0.42 │ 0.15 │ 0.11 │
           ├──────┼──────┼──────┼──────┼──────┤
     C     │ 0.45 │ 0.42 │ 1.00 │ 0.18 │ 0.14 │
           ├──────┼──────┼──────┼──────┼──────┤
     D     │ 0.12 │ 0.15 │ 0.18 │ 1.00 │ 0.72 │
           ├──────┼──────┼──────┼──────┼──────┤
     E     │ 0.08 │ 0.11 │ 0.14 │ 0.72 │ 1.00 │
           └──────┴──────┴──────┴──────┴──────┘

Цветовая шкала: 🟦 0.0 ─────────────── 1.0 🟥
```

#### Требования к матрице

- **Заголовки**: латинские буквы (A, B, C...) по горизонтали и вертикали
- **Ячейки**:
  - Цвет фона: градиент от синего (низкое сходство) до красного (высокое)
  - Текст: числовое значение сходства (2 знака после запятой)
  - Диагональ (A-A, B-B...): всегда 1.00, выделена особым цветом (например, серым)
- **Интерактивность**:
  - При наведении на ячейку — tooltip с полным текстом обеих фраз
  - При клике на ячейку — выбираются соответствующие две фразы в списке
- **Адаптивность**:
  - При большом количестве фраз (>10) — возможность скролла или уменьшение шрифта
  - Легенда с цветовой шкалой внизу или сбоку

#### Алгоритм построения

```typescript
function buildSimilarityMatrix(phrases: Phrase[]): number[][] {
  const n = phrases.length;
  const matrix: number[][] = [];
  
  for (let i = 0; i < n; i++) {
    matrix[i] = [];
    for (let j = 0; j < n; j++) {
      if (i === j) {
        matrix[i][j] = 1.0; // Диагональ
      } else if (j < i) {
        matrix[i][j] = matrix[j][i]; // Симметрия
      } else {
        matrix[i][j] = cosineSimilarity(
          phrases[i].embedding,
          phrases[j].embedding
        );
      }
    }
  }
  
  return matrix;
}
```

#### Цветовая схема матрицы

```typescript
function getColorForSimilarity(value: number): string {
  // Градиент: синий (0) → белый (0.5) → красный (1)
  // Или: тёмно-синий → голубой → жёлтый → оранжевый → красный
  
  // Вариант для тёмной темы:
  // 0.0-0.3: оттенки синего (#1e3a5f → #3b82f6)
  // 0.3-0.6: оттенки фиолетового (#8b5cf6)
  // 0.6-0.8: оттенки оранжевого (#f97316)
  // 0.8-1.0: оттенки красного (#ef4444 → #dc2626)
}
```

---

### 7. 2D Scatter Plot (UMAP) — **пространственная визуализация**

Проекция всех фраз на двумерную плоскость с сохранением семантических расстояний.

#### Внешний вид

```
┌─────────────────────────────────────────────────────────┐
│                                                         │
│         A • "Кошка спит на диване"                     │
│            B • "Кот лежит на кровати"                  │
│               C • "Котёнок отдыхает"                   │
│                                                         │
│     D • "Собака бежит"                                 │
│        E • "Пёс гуляет"                                │
│                                                         │
│                                                         │
│                              F • "Tesla модель"        │
│                            G • "Машина едет"           │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

#### Требования к scatter plot

- **Точки**:
  - Каждая фраза — точка с буквенной меткой (A, B, C...)
  - Цвет точек: красный (акцентный цвет приложения)
  - Размер: достаточный для клика (min 12px)
- **Метки**:
  - Рядом с точкой — буква фразы
  - При наведении — tooltip с полным текстом фразы
- **Интерактивность**:
  - При клике на точку — выбор фразы в списке
  - Zoom и pan (опционально)
  - При наведении — подсветка связей с другими точками (линии с opacity = similarity)
- **Алгоритм**: UMAP (предпочтительно) или t-SNE
- **Условие отображения**: появляется при 3+ фразах (для 1-2 фраз не имеет смысла)

#### Библиотека для UMAP

```typescript
// Использовать umap-js (работает в браузере)
import { UMAP } from 'umap-js';

function projectTo2D(embeddings: number[][]): [number, number][] {
  const umap = new UMAP({
    nComponents: 2,
    nNeighbors: Math.min(15, embeddings.length - 1),
    minDist: 0.1,
    spread: 1.0,
  });
  
  const projection = umap.fit(embeddings);
  return projection as [number, number][];
}
```

#### Важные нюансы

- UMAP требует минимум 3 точки для осмысленной проекции
- При добавлении новой фразы — пересчёт всей проекции (позиции могут сместиться)
- Добавить индикатор загрузки при пересчёте
- Результат недетерминированный — при каждом запуске позиции могут немного отличаться

---

### 8. Легенда фраз

Отдельный блок со списком всех фраз и их буквенных обозначений:

```
┌─────────────────────────────────────────────────────────┐
│  Легенда                                                │
├─────────────────────────────────────────────────────────┤
│  🔴 A — "Кошка спит на диване"                         │
│  🔴 B — "Кот лежит на кровати"                         │
│  🔴 C — "Котёнок отдыхает"                             │
│  🔴 D — "Собака бежит по парку"                        │
│  🔴 E — "Пёс гуляет на улице"                          │
│  🔴 F — "Tesla выпустила новую модель"                 │
│  🔴 G — "Машина едет по трассе"                        │
└─────────────────────────────────────────────────────────┘
```

Используется для быстрой расшифровки букв в матрице и на scatter plot.

---

## Технические требования

### Стек технологий

- **Framework**: React 18+ (Vite)
- **UI библиотека**: shadcn/ui
- **Стилизация**: Tailwind CSS
- **Состояние**: React useState/useReducer (без Redux, проект простой)
- **HTTP клиент**: fetch или axios
- **Сборка**: Vite
- **Визуализация**:
  - `recharts` — для матрицы сходства (heatmap)
  - `umap-js` — для понижения размерности
  - Альтернатива: `d3` или `plotly.js`

### Дизайн

- **Тема**: Тёмная (dark mode only)
- **Акцентный цвет**: Красный (`red-500`, `red-600`)
- **Фокусные состояния**: Красная обводка
- **Стиль**: Минималистичный, чистый, современный

### Цветовая схема (Tailwind)

```javascript
// tailwind.config.js расширение
{
  theme: {
    extend: {
      colors: {
        primary: {
          DEFAULT: '#ef4444', // red-500
          foreground: '#ffffff',
        },
        accent: {
          DEFAULT: '#dc2626', // red-600
        },
        // Цвета для матрицы сходства
        similarity: {
          low: '#1e40af',      // blue-800
          medium: '#7c3aed',   // violet-600
          high: '#ef4444',     // red-500
          identical: '#374151', // gray-700 (диагональ)
        }
      }
    }
  }
}
```

### Компоненты shadcn/ui

- `Input` — поле ввода фраз
- `Button` — кнопки действий
- `Checkbox` — выбор фраз для сравнения
- `Card` — контейнеры для секций
- `Progress` — визуализация сходства
- `Badge` — буквенные метки фраз (A, B, C...)
- `Dialog` — модальное окно настроек
- `Select` — выбор провайдера/модели
- `Separator` — разделители
- `Tooltip` — подсказки (для ячеек матрицы и точек scatter)
- `Tabs` — переключение между визуализациями (опционально)

---

## Структура проекта

```
embedding-explorer/
├── src/
│   ├── components/
│   │   ├── ui/                       # shadcn/ui компоненты
│   │   ├── PhraseInput.tsx           # Поле ввода фразы
│   │   ├── PhraseList.tsx            # Список фраз с чекбоксами
│   │   ├── PhraseItem.tsx            # Отдельный элемент списка
│   │   ├── PhraseBadge.tsx           # Буквенный badge (A, B, C...)
│   │   ├── SimilarityDisplay.tsx     # Детальное сравнение двух фраз
│   │   ├── SimilarityMatrix.tsx      # Тепловая карта матрицы
│   │   ├── ScatterPlot.tsx           # 2D UMAP визуализация
│   │   ├── PhraseLegend.tsx          # Легенда с расшифровкой букв
│   │   ├── VisualizationPanel.tsx    # Контейнер для визуализаций
│   │   ├── SettingsDialog.tsx        # Настройки провайдера
│   │   └── Header.tsx                # Шапка с логотипом и настройками
│   ├── hooks/
│   │   ├── useEmbeddings.ts          # Хук для работы с API эмбеддингов
│   │   ├── useCosineSimilarity.ts    # Хук для расчёта сходства
│   │   ├── useSimilarityMatrix.ts    # Хук для построения матрицы
│   │   └── useUMAP.ts                # Хук для UMAP проекции
│   ├── lib/
│   │   ├── embeddings/
│   │   │   ├── ollama.ts             # Клиент Ollama API
│   │   │   ├── openai.ts             # Клиент OpenAI API
│   │   │   └── index.ts              # Фабрика/роутер
│   │   ├── similarity.ts             # Функции сходства
│   │   ├── matrix.ts                 # Построение матрицы
│   │   ├── projection.ts             # UMAP проекция
│   │   ├── colors.ts                 # Цветовые утилиты для визуализаций
│   │   └── utils.ts                  # Общие утилиты
│   ├── types/
│   │   └── index.ts                  # TypeScript типы
│   ├── App.tsx
│   ├── main.tsx
│   └── index.css
├── .env.example
├── package.json
├── tailwind.config.js
├── vite.config.ts
└── README.md
```

---

## Типы данных

```typescript
// types/index.ts

// Буквенный идентификатор
type PhraseLabel = 'A' | 'B' | 'C' | 'D' | 'E' | 'F' | 'G' | 'H' | 'I' | 'J' |
                   'K' | 'L' | 'M' | 'N' | 'O' | 'P' | 'Q' | 'R' | 'S' | 'T' |
                   'U' | 'V' | 'W' | 'X' | 'Y' | 'Z';

const LABELS: PhraseLabel[] = [
  'A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J',
  'K', 'L', 'M', 'N', 'O', 'P', 'Q', 'R', 'S', 'T',
  'U', 'V', 'W', 'X', 'Y', 'Z'
];

interface Phrase {
  id: string;
  label: PhraseLabel;           // Буквенный идентификатор (A, B, C...)
  text: string;
  embedding: number[];
  createdAt: Date;
  provider: EmbeddingProvider;
  model: string;
}

type EmbeddingProvider = 'ollama' | 'openai';

interface EmbeddingModel {
  id: string;
  name: string;
  provider: EmbeddingProvider;
  dimensions: number;
}

interface Settings {
  provider: EmbeddingProvider;
  model: string;
  openaiApiKey?: string;
  ollamaBaseUrl: string;
}

interface SimilarityResult {
  phraseA: Phrase;
  phraseB: Phrase;
  similarity: number;           // -1 to 1
  normalizedSimilarity: number; // 0 to 1
  interpretation: 'identical' | 'high' | 'medium' | 'low' | 'opposite';
}

// Матрица сходства
interface SimilarityMatrix {
  labels: PhraseLabel[];        // ['A', 'B', 'C', ...]
  values: number[][];           // Матрица NxN
  phrases: Phrase[];            // Исходные фразы для tooltip'ов
}

// Точка на 2D scatter plot
interface ProjectedPoint {
  label: PhraseLabel;
  text: string;
  x: number;
  y: number;
  originalIndex: number;
}

// Данные для scatter plot
interface ScatterData {
  points: ProjectedPoint[];
  isComputing: boolean;
}
```

---

## API интеграция

### Ollama API

```typescript
// lib/embeddings/ollama.ts

async function getOllamaEmbedding(
  text: string, 
  model: string = 'bge-m3',
  baseUrl: string = 'http://localhost:11434'
): Promise<number[]> {
  const response = await fetch(`${baseUrl}/api/embeddings`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      model: model,
      prompt: text
    })
  });
  
  const data = await response.json();
  return data.embedding;
}
```

### OpenAI API

```typescript
// lib/embeddings/openai.ts

async function getOpenAIEmbedding(
  text: string,
  model: string = 'text-embedding-3-small',
  apiKey: string
): Promise<number[]> {
  const response = await fetch('https://api.openai.com/v1/embeddings', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'Authorization': `Bearer ${apiKey}`
    },
    body: JSON.stringify({
      model: model,
      input: text
    })
  });
  
  const data = await response.json();
  return data.data[0].embedding;
}
```

---

## Алгоритмы

### Косинусное сходство

```typescript
// lib/similarity.ts

function cosineSimilarity(vectorA: number[], vectorB: number[]): number {
  if (vectorA.length !== vectorB.length) {
    throw new Error('Vectors must have the same dimensions');
  }
  
  let dotProduct = 0;
  let normA = 0;
  let normB = 0;
  
  for (let i = 0; i < vectorA.length; i++) {
    dotProduct += vectorA[i] * vectorB[i];
    normA += vectorA[i] * vectorA[i];
    normB += vectorB[i] * vectorB[i];
  }
  
  normA = Math.sqrt(normA);
  normB = Math.sqrt(normB);
  
  if (normA === 0 || normB === 0) {
    return 0;
  }
  
  return dotProduct / (normA * normB);
}

function interpretSimilarity(similarity: number): string {
  if (similarity >= 0.95) return 'identical';
  if (similarity >= 0.7) return 'high';
  if (similarity >= 0.4) return 'medium';
  if (similarity >= 0.1) return 'low';
  return 'opposite';
}
```

### Построение матрицы сходства

```typescript
// lib/matrix.ts

function buildSimilarityMatrix(phrases: Phrase[]): SimilarityMatrix {
  const n = phrases.length;
  const labels = phrases.map(p => p.label);
  const values: number[][] = [];
  
  for (let i = 0; i < n; i++) {
    values[i] = [];
    for (let j = 0; j < n; j++) {
      if (i === j) {
        values[i][j] = 1.0;
      } else if (j < i) {
        values[i][j] = values[j][i]; // Используем симметрию
      } else {
        values[i][j] = cosineSimilarity(
          phrases[i].embedding,
          phrases[j].embedding
        );
      }
    }
  }
  
  return { labels, values, phrases };
}
```

### UMAP проекция

```typescript
// lib/projection.ts
import { UMAP } from 'umap-js';

async function projectToScatter(phrases: Phrase[]): Promise<ProjectedPoint[]> {
  if (phrases.length < 3) {
    throw new Error('UMAP requires at least 3 points');
  }
  
  const embeddings = phrases.map(p => p.embedding);
  
  const umap = new UMAP({
    nComponents: 2,
    nNeighbors: Math.min(15, phrases.length - 1),
    minDist: 0.1,
    spread: 1.0,
    random: Math.random, // Для воспроизводимости можно заменить на seeded random
  });
  
  const projection = umap.fit(embeddings);
  
  return phrases.map((phrase, index) => ({
    label: phrase.label,
    text: phrase.text,
    x: projection[index][0],
    y: projection[index][1],
    originalIndex: index,
  }));
}
```

### Цвет для значения сходства

```typescript
// lib/colors.ts

function getSimilarityColor(value: number): string {
  // Градиент для тёмной темы
  if (value >= 0.95) return '#374151'; // gray-700 (диагональ/идентичные)
  if (value >= 0.8) return '#dc2626';  // red-600
  if (value >= 0.6) return '#ef4444';  // red-500
  if (value >= 0.4) return '#f97316';  // orange-500
  if (value >= 0.2) return '#8b5cf6';  // violet-500
  return '#3b82f6';                     // blue-500
}

// Или через HSL для плавного градиента
function getSimilarityColorHSL(value: number): string {
  // value: 0 → синий (hue=220), 1 → красный (hue=0)
  const hue = (1 - value) * 220;
  const saturation = 70;
  const lightness = 50;
  return `hsl(${hue}, ${saturation}%, ${lightness}%)`;
}
```

---

## UI/UX спецификация

### Макет страницы

```
┌─────────────────────────────────────────────────────────────────────────────┐
│  🔴 Embedding Explorer                                      [⚙️ Settings]   │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ┌───────────────────────────────────────────────────┐ ┌─────────────────┐  │
│  │ Введите фразу...                                  │ │    Добавить     │  │
│  └───────────────────────────────────────────────────┘ └─────────────────┘  │
│                                                                             │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ┌─────────────────────────────┐  ┌─────────────────────────────────────┐   │
│  │ Фразы                       │  │ Матрица сходства                    │   │
│  ├─────────────────────────────┤  ├─────────────────────────────────────┤   │
│  │ ☐  🔴A  Кошка спит на диване│  │       A    B    C    D    E         │   │
│  │ ☐  🔴B  Кот лежит на кровати│  │    ┌────┬────┬────┬────┬────┐      │   │
│  │ ☐  🔴C  Собака бежит        │  │  A │1.00│0.87│0.45│0.12│0.08│      │   │
│  │ ☐  🔴D  Машина едет         │  │    ├────┼────┼────┼────┼────┤      │   │
│  │ ☐  🔴E  Tesla модель        │  │  B │0.87│1.00│0.42│0.15│0.11│      │   │
│  │                             │  │    ├────┼────┼────┼────┼────┤      │   │
│  │                             │  │  C │0.45│0.42│1.00│0.18│0.14│      │   │
│  │                             │  │    ├────┼────┼────┼────┼────┤      │   │
│  │                             │  │  D │0.12│0.15│0.18│1.00│0.72│      │   │
│  │                             │  │    ├────┼────┼────┼────┼────┤      │   │
│  │                             │  │  E │0.08│0.11│0.14│0.72│1.00│      │   │
│  │                             │  │    └────┴────┴────┴────┴────┘      │   │
│  │                             │  │                                     │   │
│  │                             │  │  🟦 0.0 ─────────────── 1.0 🟥      │   │
│  └─────────────────────────────┘  └─────────────────────────────────────┘   │
│                                                                             │
│  ┌──────────────────────────────────────────────────────────────────────┐   │
│  │ 2D Проекция (UMAP)                                                   │   │
│  ├──────────────────────────────────────────────────────────────────────┤   │
│  │                                                                      │   │
│  │         A •                                                          │   │
│  │            B •                                                       │   │
│  │                                                                      │   │
│  │     C •                                                              │   │
│  │                                                                      │   │
│  │                                      D •                             │   │
│  │                                    E •                               │   │
│  │                                                                      │   │
│  └──────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
│  ┌──────────────────────────────────────────────────────────────────────┐   │
│  │ Детальное сравнение: A ↔ B                                          │   │
│  ├──────────────────────────────────────────────────────────────────────┤   │
│  │  Cosine Similarity: 0.87                                            │   │
│  │  ████████████████████████████░░░░░░░░░░  87%                        │   │
│  │  Интерпретация: Высокое сходство                                    │   │
│  │                                                                      │   │
│  │  A: "Кошка спит на диване"                                          │   │
│  │  B: "Кот лежит на кровати"                                          │   │
│  │                                                                      │   │
│  │  cos(A,B) = (A·B) / (||A|| × ||B||)                                 │   │
│  └──────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### Состояния интерфейса

1. **Начальное состояние**: Пустой список, пустая матрица, приглашение ввести первую фразу
2. **1 фраза**: Матрица 1×1 (только диагональ), scatter plot не отображается
3. **2 фразы**: Матрица 2×2, scatter plot не отображается (минимум 3 для UMAP)
4. **3+ фразы**: Матрица N×N, scatter plot отображается
5. **Загрузка**: Спиннер при вычислении эмбеддинга и пересчёте UMAP
6. **Две выбраны**: Детальное сравнение отображается
7. **Ошибка API**: Toast с сообщением об ошибке

---

## Образовательные элементы

### Информационный блок (опционально)

Добавить expandable секцию с объяснением:

1. **Что такое эмбеддинг?**
   - Векторное представление текста
   - Размерность вектора (например, 1024 для bge-m3, 1536 для ada-002)

2. **Косинусное сходство**
   - Формула с визуализацией
   - Почему используется косинус, а не евклидово расстояние

3. **Матрица сходства**
   - Как читать тепловую карту
   - Что означают цвета

4. **UMAP проекция**
   - Зачем нужно понижение размерности
   - Почему похожие фразы оказываются рядом

5. **Применение в RAG**
   - Поиск релевантных документов
   - Semantic search

---

## Локальное хранение

- Настройки (провайдер, модель, API key) сохраняются в `localStorage`
- История фраз НЕ сохраняется (обнуляется при перезагрузке — это демо)
- API ключ хранится зашифрованным или с предупреждением о безопасности

---

## Обработка ошибок

| Ситуация | Действие |
|----------|----------|
| Ollama недоступен | Toast: "Ollama не запущен. Запустите `ollama serve`" |
| Неверный OpenAI ключ | Toast: "Неверный API ключ OpenAI" |
| Модель не найдена | Toast: "Модель {model} не найдена. Выполните `ollama pull {model}`" |
| Сетевая ошибка | Toast: "Ошибка сети. Проверьте подключение" |
| Пустой ввод | Валидация: не отправлять пустые строки |
| Максимум фраз (26) | Toast: "Достигнут максимум фраз (A-Z)" |
| UMAP с < 3 фраз | Скрыть scatter plot, показать подсказку |

---

## Запуск проекта

### Prerequisites

```bash
# Для Ollama
ollama pull bge-m3
ollama serve

# Для OpenAI
# Получить API key на platform.openai.com
```

### Установка

```bash
git clone <repo>
cd embedding-explorer
npm install
cp .env.example .env  # Добавить VITE_OPENAI_API_KEY если нужно
npm run dev
```

### .env.example

```env
# Опционально — можно ввести в интерфейсе
VITE_OPENAI_API_KEY=sk-...

# Ollama (по умолчанию localhost)
VITE_OLLAMA_BASE_URL=http://localhost:11434
```

### Зависимости для визуализаций

```bash
npm install umap-js recharts
# или
npm install umap-js d3
```

---

## Критерии приёмки

### Базовый функционал
- [ ] Приложение запускается без ошибок
- [ ] Тёмная тема с красными акцентами корректно отображается
- [ ] Можно добавлять фразы в список
- [ ] Каждая фраза получает буквенный идентификатор (A, B, C...)
- [ ] Эмбеддинги вычисляются через Ollama (bge-m3)
- [ ] Эмбеддинги вычисляются через OpenAI (при наличии ключа)
- [ ] Можно выбрать ровно две фразы чекбоксами
- [ ] Косинусное сходство вычисляется и отображается корректно
- [ ] Настройки провайдера работают
- [ ] Ошибки обрабатываются и показываются пользователю

### Визуализации
- [ ] Матрица сходства отображается корректно
- [ ] Заголовки матрицы — буквы (A, B, C...)
- [ ] Цвета ячеек соответствуют значениям сходства
- [ ] Tooltip при наведении на ячейку показывает тексты фраз
- [ ] Клик по ячейке выбирает соответствующие фразы
- [ ] Scatter plot появляется при 3+ фразах
- [ ] Точки на scatter plot подписаны буквами
- [ ] Tooltip при наведении на точку показывает текст фразы
- [ ] Похожие фразы расположены близко на scatter plot

### Интерфейс
- [ ] Интерфейс адаптивен (работает на мобильных)
- [ ] Буквенные badge'и отображаются корректно
- [ ] Легенда понятна и читаема

---

## Возможные расширения (v2)

- Выбор метрики сходства (косинус, евклид, dot product)
- Экспорт матрицы в CSV/PNG
- Сохранение сессий
- Поддержка других провайдеров (Cohere, Voyage AI)
- Batch-ввод нескольких фраз
- Анимация при добавлении новой точки на scatter plot
- Кластеризация и автоматическая группировка фраз
- Сравнение двух наборов фраз (например, запросы vs документы)